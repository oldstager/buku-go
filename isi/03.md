# Struktur Program Go: Tanpa *Modules* dan Dengan *Modules*

Secara umum, teknik penulisan kode sumber pada Go ini harus dipahami terlebih dahulu sebelum memulai
*coding*. Go telah melalui berbagai teknik penulisan kode sumber. Sampai saat ini, kita bisa
memisahkan menjadi 2 bagian besar:

1. Tanpa *modules* (Go sebelum 1.11)
2. Menggunakan *modules* (Go 1.11 ke atas dengan transisi pada Go 1.11 dan Go 1.12, mulai menggunakan *modules* secara penuh pada versi 1.13).

## Persiapan

Untuk mempelajari bab ini, ada beberapa kode sumber yang harus disiapkan. Kode sumber ini akan
ditulis disini lebih dahulu supaya memudahkan untuk diacu pada pembahasan berikutnya.

Nama file: `showuserenv.go`

~~~go
/*
	showuserenv.go

	Contoh program sederhana untuk menjelaskan
	struktur program Go untuk aplikasi executable

	(c) 2019 - bpdp.name

*/

// Program Go diawali dengan nama paket.
// Paket untuk aplikasi executable selalu berada
// pada paket main.
package main

// pustaka standar yang diperlukan
// Jika hanya satu:
// import "fmt"
// Jika lebih dari satu:
import (
	"fmt"
	"os"
)

// "Fungsi" merupakan satuan terintegrasi dari
// program Go, selalu diberi nama "main" untuk
// aplikasi executable.
func main() {

	// ini adalah kode sumber / program Go
	// akan dijelaskan lebih lanjut, abaikan
	// jika belum paham
	var (
		user    string
		homeDir string
	)

	user = os.Getenv("USER")
	homeDir = os.Getenv("HOME")

	fmt.Printf("Halo %s", user)
	fmt.Printf("\nHome anda di %s", homeDir)
	fmt.Printf("\n")

}
~~~

Nama file: `showgoenv.go`

~~~go
/*
	showgoenv.go

	Contoh program sederhana untuk menjelaskan
	struktur program Go untuk lebih dari satu
        binary executable

	(c) 2019 - bpdp.name

*/

package main

import (
	"fmt"
	"os"
)

func main() {

	var (
		user    string
		goHome  string
		goPath  string
	)

	user = os.Getenv("USER")
	goHome = os.Getenv("GOROOT")
	goPath = os.Getenv("GOPATH")

	fmt.Printf("Halo %s", user)
	fmt.Printf("\nAnda menggunakan Go di %s", goHome)
	fmt.Printf("\nGOPATH anda di %s", goPath)
	fmt.Printf("\n")

}
~~~

Nama file: `reverse.go`

~~~go
/*

        reverse.go
        Contoh pustaka sederhana untuk membalik kata.
	diambil dari https://golang.org/doc/code.html

*/
package stringutil

// Reverse returns its argument string reversed rune-wise left to right.
func Reverse(s string) string {
	r := []rune(s)
	for i, j := 0, len(r)-1; i < len(r)/2; i, j = i+1, j-1 {
		r[i], r[j] = r[j], r[i]
	}
	return string(r)
}
~~~

Nama file: `hellostringutil.go`

~~~go
/*

        hellostringutil.go
        Contoh sederhana untuk menggambarkan cara menggunakan lib
        Diambil dari https://golang.org/doc/code.html

*/
package main

import (
	"fmt"

	"github.com/bpdp/stringutil"
)

func main() {
	fmt.Printf(stringutil.Reverse("!oG ,olleH"))
}
~~~

## Tanpa *Modules*

Pada awalnya, Go menggunakan variabel lingkungan $GOPATH untuk mengelola proyek. Biasanya - seperti
terlihat pada bab awal buku ini - $GOPATH berisi direktori workspace tempat *developer* menuliskan
kode sumber. Jika kode sumber sudah cukup kompleks dan melibatkan banyak pustaka internal maupun
eksternal, maka GOPATH ini perlu diatur, jika sederhana (hanya 1 *binary executable* tanpa pustaka
internal maupun eksternal), maka $GOPATH tidak perlu diatur.

### Program Aplikasi Sederhana - 1 File `binary executable` Utama

Suatu aplikasi `executable` (artinya bisa dijalankan secara langsung oleh sistem operasi) mempunyai struktur seperti yang terlihat pada listing `showuserenv.go`. Untuk kasus sederhana seperti ini, file bisa diletakkan dimana saja. Untuk menjalankan kode sumber tersebut, ikuti langkah-langkah berikut:

#### Tanpa Proses Kompilasi

~~~bash
$ go run aplikasi.go
Halo bpdp
Home anda di /home/bpdp
~~~

#### Mengkompilasi Menjadi *Binary Executable*

~~~bash
$ go build showuserenv.go 
$ ls -la
total 1992
drwxr-xr-x 2 bpdp bpdp    4096 Jul 29 06:41 ./
drwxr-xr-x 3 bpdp bpdp    4096 Jul 29 06:36 ../
-rwxr-xr-x 1 bpdp bpdp 2027001 Jul 29 06:41 showuserenv*
-rw-r--r-- 1 bpdp bpdp     813 Jul 29 06:39 showuserenv.go
$ ./showuserenv
Halo bpdp
Home anda di /home/bpdp
$ file showuserenv
showuserenv: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, Go BuildID=9rxlkJ0BRey3wgq8FCzN/hTjP17z9sr3yZTvx1JEZ/KJMv7CpJpm_WaUyomyhS/rvGW2o0cNy_kmNe0caJe, not stripped
$ strip showuserenv
$ ls -la
total 1408
drwxr-xr-x 2 bpdp bpdp    4096 Jul 29 06:42 ./
drwxr-xr-x 3 bpdp bpdp    4096 Jul 29 06:36 ../
-rwxr-xr-x 1 bpdp bpdp 1428296 Jul 29 06:42 showuserenv*
-rw-r--r-- 1 bpdp bpdp     813 Jul 29 06:39 showuserenv.go
$ ./showuserenv
Halo bpdp
Home anda di /home/bpdp
$
~~~

### Program Aplikasi: Lebih dari 1 File `binary executable`

Jika tanpa pustaka internal maupun eksternal, maka membangun lebih dari satu *binary executable*
dilakukan cukup dengan meletakkan pada sembarang direktori dan mem-*build* satu persatu.

~~~bash
$ ls -la
total 16
drwxr-xr-x 2 bpdp bpdp 4096 Jul 29 06:52 ./
drwxr-xr-x 4 bpdp bpdp 4096 Jul 29 06:51 ../
-rw-r--r-- 1 bpdp bpdp  503 Jul 29 06:52 showgoenv.go
-rw-r--r-- 1 bpdp bpdp  813 Jul 29 06:51 showuserenv.go
$ go build showgoenv.go
$ go build showuserenv.go
$ ls -la
total 3976
drwxr-xr-x 2 bpdp bpdp    4096 Jul 29 06:52 ./
drwxr-xr-x 4 bpdp bpdp    4096 Jul 29 06:51 ../
-rwxr-xr-x 1 bpdp bpdp 2027001 Jul 29 06:52 showgoenv*
-rw-r--r-- 1 bpdp bpdp     503 Jul 29 06:52 showgoenv.go
-rwxr-xr-x 1 bpdp bpdp 2027001 Jul 29 06:52 showuserenv*
-rw-r--r-- 1 bpdp bpdp     813 Jul 29 06:51 showuserenv.go
$
~~~

### Pustaka / Library / Package dan Penggunaannya

Ada kalanya, para software developer membangun pustaka yang berisi berbagai fungsionalitas yang bisa digunakan kembali suatu saat nanti. Untuk keperluan ini, Go menyediakan fasilitas untuk membangun library dalam bentuk kumpulan fungsi. Kumpulan fungsi ini nantinya akan diletakkan pada suatu repo tertentu sehingga bisa langsung di `go get <lokasi repo pustaka>`. Pada penjelasan berikut ini, kita akan membangun suatu aplikasi kecil (hello) yang menggunakan suatu pustaka yang sebelumnya sudah kita bangun (stringutil/Reverse - untuk membalik kata). Kode sumber diambil dari [How to write Go code](https://golang.org/doc/code.html).

#### Mengatur Workspace

Ada 3 direktori di workspace yang disiapkan: bin, pkg, dan src:

* bin: berisi hasil kompilasi aplikasi (hello)
* pkg: berisi hasil kompilasi pustaka (stringutil)
* src: kode sumber untuk pustaka serta aplikasi

Pada direktori tersebut, juga dibuat `env.sh`.

~~~bash
$ ls
total 4
drwxr-xr-x 1 bpdp users 30 Sep 12 23:16 .
drwxr-xr-x 1 bpdp users 56 Sep 12 23:05 ..
drwxr-xr-x 1 bpdp users 10 Sep 12 23:16 bin
-rw-r--r-- 1 bpdp users 50 Sep 12 23:05 env.sh
drwxr-xr-x 1 bpdp users 22 Sep 12 23:16 pkg
drwxr-xr-x 1 bpdp users 32 Sep 12 23:07 src
$ cat env.sh
export GOPATH=`pwd`
export PATH=$PATH:$GOPATH/bin
$ source ~/env/go/go1.7.3
$ source env.sh
$
~~~

Semua kode sumber, baik untuk pustaka ataupun aplikasi akan diletakkan pada pola direktori tertentu. Go menggunakan pola repo untuk penamaan / pengelompokan aplikasi atau pustaka meskipun belum dimasukkan ke repo di Internet. Sebaiknya membiasakan diri sejak awal menggunakan pola tersebut meskipun belum akan dimasukkan ke repositori di Internet.

### Membuat Pustaka

Kode sumber untuk pustaka ini akan diletakkan di `src/github.com/bpdp/stringutil`. Paket yang dibuat dengan penamaan ini, nantinya akan diacu dalam `import` sebagai `github.com/bpdp/stringutil`.

ISIKAN reverse.go disini

Untuk mengkompilasi:

~~~bash
$ go build github.com/bpdp/stringutil
$
~~~

Jika tidak ada kesalahan, maka akan langsung kembali ke prompt shell.

### Membuat Aplikasi yang Memanfaatkan Pustaka

Sama halnya dengan pustaka, aplikasi juga menggunakan pola penamaan yang sama.

ISIKAN hellostringutil.go

Untuk mengkompilasi:

~~~bash
$ go install github.com/bpdp/hello
$ hello
Hello, Go!
$ ls bin/
total 1612
drwxr-xr-x 1 bpdp users      10 Sep 12 23:16 .
drwxr-xr-x 1 bpdp users      30 Sep 12 23:16 ..
-rwxr-xr-x 1 bpdp users 1650409 Sep 12 23:16 hello
$
~~~

